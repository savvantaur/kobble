<Proxy balancer://spokecluster.spanner.org>
  BalancerMember http://bluebottle.spanner.org:8020
  BalancerMember http://bluebottle.spanner.org:8021
  BalancerMember http://bluebottle.spanner.org:8022
  # BalancerMember http://seagoon.spanner.org:8020
  # BalancerMember http://seagoon.spanner.org:8021
  # BalancerMember http://seagoon.spanner.org:8022
</Proxy>

<VirtualHost *:80>

  DocumentRoot /var/www/spoke/current/public
  ServerAdmin sysadmin@spanner.org

  ServerName spoke.spanner.org
  ServerAlias spoke.sparknow.net
  ServerAlias mlal.sparknow.net

  <Directory "/var/www/spoke/current/public">
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>

  <Location /bm>
    SetHandler balancer-manager
    Order allow,deny
    Deny from all
  </Location>

  # Check for maintenance file. Let apache load it if it exists
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteRule . /system/maintenance.html [L]

  # Let apache serve static files
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f
  RewriteRule (.*) $1 [L]

  ProxyRequests Off
	ProxyPass /images !
	ProxyPass /js !
	ProxyPass /stylesheets !
	ProxyPass /node !
	ProxyPass /source !
	ProxyPass /person !
  ProxyPass / balancer://spokecluster.spanner.org/

  ProxyPassReverse / balancer://spokecluster.spanner.org/
  ProxyReceiveBufferSize 49152

  CustomLog /var/www/spoke/apachelogs/access_log combined
  ErrorLog /var/www/spoke/apachelogs/error_log

</VirtualHost>
