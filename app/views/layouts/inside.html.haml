!!! 1.1
- @inline = false
- @title ||= 'welcome'

%html
  %head
    %title
      kobble
      - if @title
        \:
      = @title
    = javascript_include_tag 'mootools', 'mootools-more'
    = javascript_include_tag 'autocompleter/Autocompleter.js', 'autocompleter/Autocompleter.Request.js', 'autocompleter/Observer.js'
    = javascript_include_tag 'swfupload/swfupload', 'swfupload/swfupload.cookies', 'swfupload/swfupload.queue', 'swfupload/swfupload.speed'
    = javascript_include_tag 'kobble/dragdrop', 'kobble/collapser', 'kobble/navigation', 'kobble/suggester', 'kobble/inline_links', 'kobble/zoomer', 'kobble/kore'
    = yield :extra_js
    = stylesheet_link_tag 'kobble', :cache => "cache/kobble"
    = yield :extra_css

%body
  #mainpage
    #pagetitle
      %h1{:class => @title.size > 50  ? "long_title" : "short_title"}
        = @title
        - if @thing && !@thing.is_a?(Collection)
          %span.header_icon<>
            = link_to icon_for(@thing), collected_url_for(@thing), :id => "#{@thing.class.to_s.downcase}_#{@thing.id}", :class => "draggable #{@thing.class.to_s.downcase}", :title => @thing.name
                      
    #canvas
      = yield

  #masthead
    %ul.nav
      %li#kobble_navigation.mi<>
        = link_to "kobble/", "/", :class => 'head'
        %ul.body
          %li.smi
            = link_to "kobble", '/'
          %li.smi
            = link_to "help", '#'
          %ul.sm
            %li.smi
              = link_to "about", '#'
          %ul.sm
            %li.smi
              = link_to "forum", '#'
          %ul.sm
            %li.smi
              = link_to "logout", '#'
        
      %li#account_navigation.mi<>
        = link_to "#{current_account.name}/", root_url, {:class => current_collection ? 'head ' : 'head emphatic'} 
        %ul.body
          %li.smi
            = link_to "#{current_account.name}/", root_url, {:class => current_collection ? ' ' : 'emphatic'} 
          %li.smi
            = link_to "kobble", '/'
          %ul.sm
            %li.smi
              = link_to "collections", '#'
          %ul.sm
            %li.smi
              = link_to "users", '#'
          %ul.sm
            %li.smi
              = link_to "settings", '#'
              
      - if current_collection
        %li#collection_navigation.mi<>
          = link_to "#{current_collection.abbreviation}/", url_for(current_collection), {:class => 'head emphatic'} 
          %ul.body
            %li 
              = link_to "#{current_collection.abbreviation}/", url_for(current_collection), {:class => 'emphatic'} 
            - current_account.collections.each do |collection|
              - unless collection == current_collection
                %li.smi
                  = link_to collection.name, url_for(collection)
          
  #mastfoot
    #navigation
      = link_to 'home', root_url, {:class => 'administrative'}
      
      - if current_collection
        &gt;
        = link_to current_collection.abbreviation, url_for(current_collection), {:class => 'administrative'}
        [
        = link_to "sources", collection_sources_url(current_collection), {:class => (request.parameters[:controller] == 'sources' ? "fg" : '')}
        = link_to "fragments", collection_nodes_url(current_collection), {:class => (request.parameters[:controller] == 'nodes' ? "fg" : '')}
        = link_to "sets", collection_bundles_url(current_collection), {:class => (request.parameters[:controller] == 'bundles' ? "fg" : '')}
        = link_to "people", collection_people_url(current_collection), {:class => (request.parameters[:controller] == 'people' ? "fg" : '')}
        = link_to "tags", collection_tags_url(current_collection), {:class => (request.parameters[:controller] == 'tags' ? "fg" : '')}
        = link_to 'discussion', collection_topics_url(current_collection), {:class => request.parameters[:controller] == 'topics' ? " fg" : ''} if current_account.can_have_discussion?
        ]
      - if current_account
        = link_to 'search', search_url, {:class => 'administrative'}
        = link_to 'log out', user_session_path, :method => :delete, :class => 'administrative'

  = render :partial => 'users/bench', :locals => {:collection => current_collection}
  
  #admin
    = yield :admin

  - if flash[:notice]
    = javascript_tag %{window.addEvent('load', function(){ k.announce('#{escape_javascript(flash[:notice])}'); });}
  - if flash[:error]
    = javascript_tag %{window.addEvent('load', function(){ k.complain('#{escape_javascript(flash[:error])}'); });}
